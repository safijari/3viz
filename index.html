<!DOCTYPE html>
<html>
	  <head>
		    <title>My first three.js app</title>
		    <style>
			   body { margin: 0; }
			   canvas { width: 100%; height: 100% }
		    </style>
	  </head>

		<style>
		 body {
				 background-color: #f0f0f0;
				 color: #444;
		 }
		 a {
				 color: #08f;
		 }
		</style>

	  <body>
		    <script src="js/three.js"></script>
		    <script src="js/OrbitControls.js"></script>
        <script src="helpers.js"/></script>

		    <script>

         function startWebsocket() {
             var ws = new WebSocket('ws://localhost:8765/ws')

             ws.onclose = function(){
                 ws = null
                 setTimeout(startWebsocket, 1250)
             }


             ws.onmessage = function(ev){
                 data = JSON.parse(ev.data);
                 if (data.type == "axes") {
                     add_axes(scn, data.size, data.label, data.position, data.orientation);
                 } else if (data.type == "axes_list") {
                     for (var i = 0; i < data.elements.length; i++) {
                         var el = data.elements[i];
                         add_axes(scn, el.size, el.label, el.position, el.orientation);
                     }
                 } else if (data.type == "pointcloud") {
                     add_pointcloud(scn, data.label, data.arrs, data.position, data.orientation, data.color, data.opacity);
                 }
             };

         }


         var host = window.location.host;

         var scn = make_scene(window)

			   document.body.appendChild( scn.renderer.domElement );
			   scn.camera.position.z = 5;
			   scn.camera.position.y = -5;
			   scn.camera.position.x = -5;

         add_axes(scn, 0.5, "root", mkpos(0, 0, 0));

         function animate() {
	           requestAnimationFrame( animate );
	           scn.controls.update();
				     render_scene(scn);
         }

         startWebsocket();

         animate();

		    </script>
	  </body>
</html>
